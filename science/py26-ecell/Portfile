# -*- coding: utf-8; mode: tcl; tab-width: 4; truncate-lines: t; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:et:sw=4:ts=4:sts=4
# $Id$

PortSystem          1.0

set base_name       "ecell"

name                py26-${base_name}
version             3.2.3pre1
revision            0
categories          science
maintainers         sfc.keio.ac.jp:ynaito
license             GPLv2
homepage            http://www.e-cell.org/
description         E-Cell Simulation Environment (E-Cell SE)
long_description    E-Cell System is an object-oriented software suite \
for modeling, simulation, and analysis of large scale complex systems \
such as biological cells. Core part of the system, E-Cell Simulation \
Environment version 3, allows many components driven by multiple \
algorithms with different timescales to coexist.
conflicts           ecell py27-${base_name}

if {[regexp {^10\.} ${os.version}]} then {
    default_variants +python26 -atlas -gcc43 -gcc44 -gcc45
} 

master_sites        http://github.com/downloads/ecell/ecell3/
distname            ${base_name}-${version}
checksums           md5     0cede77b254595040f533694921cb013 \
                    sha1    176da828b0916f1e30593b9f2ae5c0c065334f8e \
                    rmd160  9dfae309dc2ba17398cb4c9549e8ec1c537e9efe
extract.suffix      .tar.bz2
use_bzip2           yes

patchfiles          patch-Polymorph.hpp.diff\
                    patch-Makefile.in.diff\
                    patch-setup.py.in.diff\
                    patch-ga.py.diff

depends_lib         port:py26-gtk \
                    path:lib/libboost_python.a:boost \
                    port:gsl \
                    port:py26-ply

configure.env-append PYTHONPATH="${prefix}/Library/Frameworks/Python.framework/Versions/2.6/lib/python2.6/site-packages:${prefix}/lib/python2.6/site-packages"

if {${configure.compiler} == "clang"} {
        configure.compiler llvm-gcc-4.2
}

notes \
"**********************************************************************
To use ecell3-session-monitor, please set environment 
variable PYTHONPATH as following:

For sh, bash:
export PYTHONPATH=\"/opt/local/Library/Frameworks/Python.framework/\\
Versions/2.6/lib/python2.6/site-packages:/opt/local/lib/python2.6/site-packages\"

For csh, tcsh:
setenv PYTHONPATH \"/opt/local/Library/Frameworks/Python.framework/\\
Versions/2.6/lib/python2.6/site-packages:/opt/local/lib/python2.6/site-packages\"
**********************************************************************"


pre-fetch {

    if {[regexp {^11\.} ${os.version}]} then {
        error "
   **************************************************************
    py26-${base_name} is a package for Mac OS X Snow Leopard (10.6) or 
    earlier. For OS X Lion (10.7), please install py27-${base_name}.
   **************************************************************"
    } 

    if {![file exists ${prefix}/lib/libboost_python.a]} {
        if {[file exists ${prefix}/lib/libboost_filesystem.a]} {
            ui_error "Please uninstall or deactivate the boost port and reinstall it by running `port install boost +python26`."
        }
        else {
            ui_error "Please install boost with the python26 variant by running `port install boost +python26`."
        }
            error "boost must be installed with the python26 variant enabled."
    }
}

post-destroot {
	set changearg "-change ${prefix}/Library/Frameworks/Python.framework/Versions/2.6/Python /System/Library/Frameworks/Python.framework/Versions/2.6/Python"

	system "install_name_tool ${changearg} ${prefix}/lib/libboost_python.dylib"
	system "install_name_tool ${changearg} ${prefix}/lib/libboost_python-mt.dylib"
}

#variant no_x11 {}
#variant quartz {}

#variant ja {}

